<?xml version="1.0" encoding="UTF-8"?>
<configuration>
    <system.webServer>
        
        <httpCompression>
            <dynamicTypes>
                <add mimeType="text/event-stream" enabled="false" />
            </dynamicTypes>
        </httpCompression>

        <handlers>
            <add name="PHP-FastCGI-Stream" 
                 path="*.php" 
                 verb="*" 
                 modules="FastCgiModule" 
                 scriptProcessor="C:\path\to\your\php\php-cgi.exe" 
                 resourceType="File"                
                 responseBufferLimit="0" 
            />
        </handlers>
        
    </system.webServer>
</configuration>







tắt Dynamic Compression hoàn toàn cho trang web của mình thông qua giao diện IIS Manager (Internet Information Services Manager):

Mở IIS Manager.

Chọn Tên máy chủ (Server Name) hoặc Trang web (Site) của bạn.

Trong cửa sổ chính, nhấp đúp vào Compression (Nén).

Bỏ chọn mục Enable dynamic content compression (Bật nén nội dung động).

Nhấn Apply ở cột Actions.

Tăng thời gian chờ FastCGI (FastCGI Timeout)
Script stream.php của bạn được thiết kế để chạy vô thời hạn (set_time_limit(0)). Tuy nhiên, môi trường PHP chạy trên IIS thông qua FastCGI có các giới hạn thời gian chờ riêng (thường là 30 hoặc 90 giây). Nếu không có dữ liệu được gửi trong khoảng thời gian đó, IIS sẽ ngắt tiến trình PHP.

Bạn cần tăng các giá trị timeout này lên rất cao (ví dụ: 12 giờ) để đảm bảo luồng SSE không bị ngắt.

Mở IIS Manager.

Chọn Tên máy chủ (Server Name).

Trong cửa sổ chính, nhấp đúp vào FastCGI Settings (Cài đặt FastCGI).

Chọn đường dẫn đến php-cgi.exe của bạn và nhấp Edit... (Chỉnh sửa) ở cột Actions.

Trong mục Process Model, tìm và đặt lại các giá trị sau:

Activity Timeout: Đặt thành 43200 (giây) hoặc một giá trị rất lớn (tương đương 12 giờ).

Request Timeout: Đặt thành 43200 (giây).

Nhấn OK và khởi động lại IIS (nếu cần thiết).